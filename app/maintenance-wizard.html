<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Sovereign Maintenance - Charter Legacy</title>
    <link rel="stylesheet" href="styles/app.css">
    <link rel="stylesheet" href="styles/wizard-premium.css">
    <!-- Removed wizard-layout.css to prevent conflicts with custom internal 900px layout -->
    <style>
        :root {
            --canvas: #F2F2F7;
            --surface: #FFFFFF;
            --obsidian-ink: #1D1D1F;
            --gold-leaf: #C6A355;
            --mist: #E5E5EA;
            --success: #34C759;
            --radius-md: 24px;
            --radius-sm: 12px;
        }

        body {
            background-color: var(--canvas);
            font-family: -apple-system, BlinkMacSystemFont, "Inter", sans-serif;
            color: var(--obsidian-ink);
            min-height: 100vh;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
        }

        .wizard-main {
            width: 100% !important;
            max-width: none !important; /* Override legacy 600px caps */
            display: flex !important;
            flex-direction: column !important;
            align-items: center !important;
            padding: 0 !important;
            margin: 0 !important;
        }

        .wizard-container {
            width: 95% !important;
            max-width: 900px !important; /* Force-align to 900px "Spacious" Standard */
            margin: 40px auto 120px !important; /* Centering Authority */
            padding: 0 !important;
            box-sizing: border-box !important;
        }

        .wizard-card {
            background: #FFFFFF;
            border-radius: 28px;
            padding: 60px; /* Premium 10/10 Internal Spacing */
            box-shadow: 0 10px 40px rgba(0,0,0,0.04);
            border: 1px solid rgba(0,0,0,0.02);
            position: relative;
            width: 100%;
            box-sizing: border-box;
        }

        .step-title {
            font-size: 1.5rem;
            font-weight: 900;
            margin-bottom: 8px;
            letter-spacing: -0.02em;
        }

        .step-subtitle {
            font-size: 0.9rem;
            color: rgba(0, 0, 0, 0.5);
            margin-bottom: 32px;
        }

        /* Inset Data Slab */
        .data-slab {
            background: #111111;
            border-radius: var(--radius-sm);
            padding: 24px;
            margin-bottom: 24px;
        }

        .data-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .data-row:last-child {
            border-bottom: none;
        }

        .data-label {
            font-size: 0.75rem;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.4);
        }

        .data-value {
            font-size: 0.85rem;
            font-weight: 700;
            color: white;
            font-family: monospace;
        }

        .data-value.active {
            color: var(--success);
        }

        /* Input Styling */
        .input-group {
            margin-bottom: 28px;
            display: flex;
            flex-direction: column;
        }

        .input-label {
            display: flex;
            align-items: flex-end; /* Align labels to the bottom of their slot */
            min-height: 3.2rem; /* Guaranteed height for 1-2 lines */
            line-height: 1.25;
            font-size: 0.65rem;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 0.14em;
            color: var(--gold-leaf);
            margin-bottom: 12px;
            padding-bottom: 2px;
        }

        .input-field {
            width: 100%;
            padding: 16px 20px;
            background: #F2F2F7;
            border: 1px solid #E5E5EA;
            border-radius: var(--radius-sm);
            font-size: 1rem;
            font-weight: 500;
            color: var(--obsidian-ink);
            transition: all 0.2s;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--gold-leaf);
            background: white;
            box-shadow: 0 0 0 4px rgba(198, 163, 85, 0.1);
        }

        /* Action Bar */
        .action-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            padding: 24px 40px;
            border-top: 1px solid #E5E5EA;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
        }

        .btn-next {
            background: var(--gold-leaf);
            color: black;
            padding: 14px 40px;
            border-radius: 12px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.8rem;
        }

        .btn-next:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(198, 163, 85, 0.4);
        }

        .btn-back {
            background: transparent;
            color: var(--obsidian-ink);
            opacity: 0.4;
            border: none;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            cursor: pointer;
            font-size: 0.75rem;
        }

        .btn-statutory-action {
            display: flex;
            align-items: center;
            gap: 6px;
            background: rgba(198, 163, 85, 0.1);
            color: var(--gold-leaf);
            border: 1px solid rgba(198, 163, 85, 0.2);
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.6rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-statutory-action:hover {
            background: var(--gold-leaf);
            color: black;
            transform: translateY(-1px);
        }

        /* Manager Slate Styling */
        /* Step Transitions */
        .wizard-step {
            display: none;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .wizard-step.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        /* Progress Bar */
        .progress-container {
            width: 100%;
            height: 4px;
            background: rgba(0,0,0,0.05);
            position: absolute;
            top: 0;
            left: 0;
            overflow: hidden;
            border-radius: 4px 4px 0 0;
        }

        .progress-fill {
            height: 100%;
            background: var(--gold-leaf);
            width: 0%;
            transition: width 0.6s cubic-bezier(0.65, 0, 0.35, 1);
            box-shadow: 0 0 10px rgba(198, 163, 85, 0.5);
        }

        /* Glassmorphism Footer */
        .action-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 20px 40px;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border-top: 1px solid rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
        }

        /* Skeleton Pulse Animation */
        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }

        .skeleton {
            animation: pulse 1.5s infinite ease-in-out;
            background: rgba(255,255,255,0.1) !important;
            border-radius: 4px;
            color: transparent !important;
        }

        /* Mailing Header Alignment */
        .mailing-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            margin-bottom: 8px;
        }

        .sync-checkbox-label {
            font-size: 0.72rem;
            font-weight: 800;
            color: var(--gold-leaf);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            padding-bottom: 6px; /* Balance with label alignment */
        }

        .maintenance-header {
            padding: 80px 20px 48px;
            text-align: center;
            width: 100%;
        }

        .filing-type {
            font-size: 0.75rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.25em;
            color: var(--gold-leaf);
            margin-bottom: 16px;
        }

        .entity-name {
            font-size: 3rem;
            font-weight: 900;
            color: rgba(28, 29, 33, 0.75); /* Authoritative Obsidian */
            letter-spacing: -0.04em;
            text-transform: uppercase;
            margin: 0;
            line-height: 1;
        }

        /* Mobile Optimization - High Fidelity Reset */
        @media (max-width: 768px) {
            .maintenance-header {
                padding: 60px 16px 32px;
            }

            .entity-name {
                font-size: 2.2rem;
                letter-spacing: -0.02em;
            }

            .wizard-main {
                padding: 0;
            }

            .wizard-container {
                padding: 0;
                margin: 0;
            }

            .wizard-card {
                padding: 40px 20px;
                border-radius: 0; /* Edge-to-edge */
                border: none;
                border-top: 1px solid rgba(0,0,0,0.05);
                box-shadow: none;
            }

            .input-group {
                margin-bottom: 28px;
            }

            .input-label {
                min-height: auto; /* Allow natural flow on single-column mobile */
                margin-bottom: 8px;
            }

            .step-title {
                font-size: 1.5rem;
            }

            .action-bar {
                padding: 16px 20px;
                background: rgba(255, 255, 255, 0.98);
                backdrop-filter: blur(20px) saturate(180%);
            }

            .btn-next, .btn-back {
                padding: 14px 24px;
                font-size: 0.75rem;
            }

            .data-row {
                flex-direction: column;
                align-items: flex-start;
                gap: 4px;
            }

            .data-value {
                font-size: 0.85rem;
            }

            .addon-card {
                padding: 16px;
                gap: 12px;
            }

            .addon-price {
                font-size: 0.9rem;
            }
        }

        @media (max-width: 480px) {
            .entity-name {
                font-size: 1.4rem;
            }
            
            .input-group label {
                font-size: 0.6rem;
            }
        }
    </style>
</head>
<body class="wizard-page">
    
    <header class="maintenance-header">
        <div class="filing-type" id="filingDisplayName">Annual Report (2026)</div>
        <h1 class="entity-name" id="entityDisplayName">Loading...</h1>
    </header>

    <main class="wizard-main">
        <div class="wizard-container">
            
            <div class="wizard-card">
                <div class="progress-container">
                    <div class="progress-fill" id="progressFill"></div>
                </div>

                <!-- STEP 1: VERIFICATION -->
                <section id="step1" class="wizard-step active">
                    <h2 class="step-title">Sovereign Audit</h2>
                    <p class="step-subtitle">Verifying current records with the Florida Division of Corporations.</p>
                    
                    <div class="data-slab">
                        <div class="data-row">
                            <span class="data-label">Document Number</span>
                            <span class="data-value" id="currentDocNum">L123456789</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">Filing Status</span>
                            <span class="data-value active">ACTIVE</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">Last Filing Date</span>
                            <span class="data-value">02/14/2025</span>
                        </div>
                    </div>

                    <div style="background: rgba(198, 163, 85, 0.05); border: 1px solid rgba(198, 163, 85, 0.2); padding: 20px; border-radius: 12px;">
                        <div style="font-weight: 900; color: var(--gold-leaf); margin-bottom: 6px; text-transform: uppercase; font-size: 0.65rem; letter-spacing: 0.1em;">Statutory Pulse</div>
                        <div style="color: rgba(0,0,0,0.6); font-size: 0.85rem; line-height: 1.5; font-weight: 500;">Annual Reports are due by May 1st. Failure to file results in a $400 late fee and eventual administrative dissolution.</div>
                    </div>
                </section>

                <!-- STEP 2: UPDATES (Addresses & Correspondence) -->
                <section id="step2" class="wizard-step">
                    <h2 class="step-title">Information Review</h2>
                    <p class="step-subtitle">Review your official record and apply any necessary changes.</p>

                    <div id="nameChangeContainer" style="display: none; background: rgba(198, 163, 85, 0.05); border: 1px solid rgba(198, 163, 85, 0.2); border-radius: 12px; padding: 20px; margin-bottom: 28px;">
                        <div class="input-group" style="margin-bottom: 0;">
                            <label class="input-label">Proposed New Entity Name</label>
                            <input type="text" class="input-field" id="inputNewName" placeholder="ENTER NEW LEGAL NAME" style="background: white;">
                        </div>
                    </div>

                    <div id="correctionContainer" style="display: none; background: rgba(198, 163, 85, 0.05); border: 1px solid rgba(198, 163, 85, 0.2); border-radius: 12px; padding: 20px; margin-bottom: 28px;">
                        <div class="input-group">
                            <label class="input-label">1. Entity Name to be Corrected</label>
                            <input type="text" class="input-field" id="inputCorrectionEntityName" readonly style="background: rgba(0,0,0,0.03); cursor: not-allowed; font-weight: 700;">
                        </div>
                        <div class="input-group">
                            <div style="display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 8px;">
                                <label class="input-label" style="margin-bottom: 0;">2. Date of original filing of the document to be corrected</label>
                                <div style="display: flex; gap: 8px;">
                                    <button type="button" class="btn-statutory-action" onclick="window.MaintenanceWizard.openSunbizLookup()" title="Open Sunbiz Investigation">
                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                                        Sunbiz
                                    </button>
                                </div>
                            </div>
                            <input type="date" class="input-field" id="inputOriginalFilingDate" style="background: white;">
                        </div>
                        <div class="input-group">
                            <label class="input-label">3. Florida Document Number</label>
                            <input type="text" class="input-field" id="inputCorrectionDocNum" readonly style="background: rgba(0,0,0,0.03); cursor: not-allowed; font-weight: 700;">
                        </div>
                        <div class="input-group">
                            <label class="input-label">4. The document to be corrected is:</label>
                            <select class="input-field" id="inputCorrectionDocType" style="background: white;">
                                <option value="">-- SELECT DOCUMENT --</option>
                                <option value="articles_of_organization">Articles of Organization</option>
                                <option value="annual_report">Annual Report</option>
                                <option value="articles_of_amendment">Articles of Amendment</option>
                                <option value="application_foreign_qualification">Application for Foreign Qualification</option>
                                <option value="other">Other Statutory Filing</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label class="input-label">5. Nature of Correction (select one)</label>
                            <select class="input-field" id="inputCorrectionReason" style="background: white;">
                                <option value="incorrect_statement">Contains an incorrect statement</option>
                                <option value="defectively_signed">Was defectively signed</option>
                                <option value="defective_transmission">Electronic transmission was defective</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label class="input-label">6. The incorrect statement and the reason it is incorrect OR the manner in which the execution was defective:</label>
                            <textarea class="input-field" id="inputErrorDescription" placeholder="Detail the defect or inaccuracy..." style="background: white; min-height: 80px; font-family: inherit;"></textarea>
                        </div>
                        <div class="input-group" style="margin-bottom: 0;">
                            <label class="input-label">7. The corrected information/statement is:</label>
                            <textarea class="input-field" id="inputCorrectionText" placeholder="Enter the corrected statutory text..." style="background: white; min-height: 80px; font-family: inherit;"></textarea>
                        </div>
                    </div>

                    <div class="input-group">
                        <label class="input-label">Principal Place of Business</label>
                        <input type="text" class="input-field" id="inputPrincipal" oninput="window.MaintenanceWizard.syncMailingAddress()">
                    </div>

                    <div class="input-group" style="margin-bottom: 20px;">
                        <div class="mailing-header">
                            <label class="input-label" style="margin-bottom: 0;">Mailing Address</label>
                            <label class="sync-checkbox-label">
                                <input type="checkbox" id="syncMailing" onchange="window.MaintenanceWizard.syncMailingAddress()"> Same as Principal
                            </label>
                        </div>
                        <input type="text" class="input-field" id="inputMailing">
                    </div>

                    <div style="border-top: 1px solid #E5E5EA; padding-top: 24px; margin-top: 24px;">
                        <div class="input-group">
                            <label class="input-label">Registered Agent Name</label>
                            <input type="text" class="input-field" id="inputAgentName" oninput="window.MaintenanceWizard.checkRAUpdate()">
                        </div>

                        <div class="input-group">
                            <label class="input-label">Registered Agent Physical Address</label>
                            <input type="text" class="input-field" id="inputAgentAddress" placeholder="Physical Florida Street Address" oninput="window.MaintenanceWizard.checkRAUpdate()">
                        </div>

                        <div id="raAcceptanceContainer" style="display: none; background: rgba(198, 163, 85, 0.05); border: 1px solid rgba(198, 163, 85, 0.2); border-radius: 12px; padding: 20px; margin-bottom: 28px;">
                            <label class="input-label">Registered Agent Acceptance Signature</label>
                            <input type="text" class="input-field" id="agentSignature" placeholder="NEW AGENT MUST SIGN TO ACCEPT" style="background: white;">
                            <p style="font-size: 0.7rem; color: var(--gold-leaf); margin-top: 10px; font-weight: 600;">Statutory Requirement: A new agent must sign to accept the appointment.</p>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="input-group">
                            <label class="input-label">FEIN</label>
                            <input type="text" class="input-field" id="inputFein" placeholder="XX-XXXXXXX">
                        </div>
                        <div class="input-group">
                            <label class="input-label">Official Correspondence Email</label>
                            <input type="email" class="input-field" id="inputEmail" placeholder="admin@entity.com">
                        </div>
                    </div>
                </section>

                <!-- STEP 3: MANAGEMENT SLATE -->
                <section id="step3" class="wizard-step">
                    <h2 class="step-title">Management Slate</h2>
                    <p class="step-subtitle">Maintain the current list of Authorized Persons or Managers.</p>

                    <div id="managerList">
                        <!-- Dynamic Manager Cards -->
                    </div>

                    <button class="btn-add-manager" onclick="window.MaintenanceWizard.addManager()">+ Add Authorized Person</button>
                </section>

                <!-- STEP 4: REVIEW / DIFF -->
                <section id="step4" class="wizard-step">
                    <h2 class="step-title">Review Changes</h2>
                    <p class="step-subtitle">Final audit of the information being scriven to the State.</p>

                    <div id="diffContainer">
                        <!-- Populated by JS -->
                    </div>

                    <div class="input-group" style="margin-top: 40px;">
                        <label class="input-label">Electronic Signature</label>
                        <input type="text" class="input-field" id="signature" placeholder="TYPE FULL LEGAL NAME">
                        <p style="font-size: 0.75rem; color: rgba(0,0,0,0.4); margin-top: 12px; line-height: 1.4; font-weight: 500;">By signing, I certify that I am authorized to file this document and that the information is correct under penalty of perjury.</p>
                    </div>
                </section>

                <!-- STEP 5: OFFICIAL CREDENTIALS -->
                <section id="step5" class="wizard-step">
                    <h2 class="step-title">Official Credentials</h2>
                    <p class="step-subtitle">Optional statutory documents to support your 2026 operations.</p>

                    <div class="addon-card" onclick="window.MaintenanceWizard.toggleAddon('certStatus')">
                        <div class="addon-checkbox" id="checkCertStatus"></div>
                        <div class="addon-info">
                            <div class="addon-name">Certificate of Status</div>
                            <div class="addon-description">Official "Good Standing" certificate from the State.</div>
                        </div>
                        <div class="addon-price">$5.00</div>
                    </div>

                    <div class="addon-card" onclick="window.MaintenanceWizard.toggleAddon('certCopy')">
                        <div class="addon-checkbox" id="checkCertCopy"></div>
                        <div class="addon-info">
                            <div class="addon-name">Certified Copy</div>
                            <div class="addon-description">State-certified copy of this Annual Report filing.</div>
                        </div>
                        <div class="addon-price">$30.00</div>
                    </div>
                </section>

                <!-- STEP 6: PAYMENT -->
                <section id="step6" class="wizard-step">
                    <h2 class="step-title">Financial Finality</h2>
                    <p class="step-subtitle">Finalizing the institutional pulse for 2026.</p>

                    <div style="text-align: center; padding: 40px 0;">
                        <div style="font-size: 0.7rem; font-weight: 900; color: var(--gold-leaf); text-transform: uppercase; margin-bottom: 20px;">Total Filing Fee</div>
                        <div style="font-size: 3.5rem; font-weight: 900; color: var(--obsidian-ink); letter-spacing: -0.05em;" id="displayTotal">$138.75</div>
                        <div style="font-size: 0.85rem; color: rgba(0,0,0,0.4); margin-top: 10px; font-weight: 500;">State Fee + Scrivener Processing</div>
                    </div>

                    <button class="btn-next" style="width: 100%;" id="btnFinalPay">Authorize Filing</button>
                </section>
            </div>

            <!-- STEP 7: SUCCESS -->
            <section id="step7" class="wizard-step">
                <div style="text-align: center; padding: 40px 0 20px;">
                    <div class="success-accent">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                    </div>
                    <h2 class="step-title">Filing Draft Ready</h2>
                    <p class="step-subtitle">Articles of Correction must be faxed or mailed. <br>Your statutory instrument is generated below.</p>
                </div>

                <!-- Statutory Instrument Preview -->
                <div id="statutoryInstrumentPreview" style="background: white; border: 1px solid #E5E5EA; border-radius: 8px; padding: 60px; margin-bottom: 40px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); font-family: 'Times New Roman', serif; color: #1c1c1e;">
                    <div style="text-align: center; border-bottom: 2px solid #000; padding-bottom: 20px; margin-bottom: 30px;">
                        <div style="font-size: 1.5rem; font-weight: bold; text-transform: uppercase;">Articles of Correction</div>
                        <div style="font-size: 0.9rem; margin-top: 4px;">Florida Department of State | Division of Corporations</div>
                    </div>

                    <div id="instrumentContent" style="font-size: 1rem; line-height: 1.6;">
                        <!-- Populated by JS -->
                    </div>

                    <div style="margin-top: 60px; border-top: 1px solid #E5E5EA; padding-top: 20px; font-size: 0.8rem; color: #8e8e93; font-family: sans-serif;">
                        * This is a draft statutory instrument generated by Charter Legacy. Please verify all details on Sunbiz.gov before mailing.
                    </div>
                </div>

                <div style="display: flex; gap: 16px; justify-content: center;">
                    <button class="btn-next" style="background: var(--obsidian-ink); color: white;" onclick="window.print()">Download/Print Instrument</button>
                    <button class="btn-back" style="margin: 0;" onclick="window.location.href='/app/obsidian-zenith.html'">Return to Console</button>
                </div>
            </section>

        </div>
    </main>

    <footer class="action-bar" id="actionBar">
        <button class="btn-back" id="btnBack">Back</button>
        <button class="btn-next" id="btnNext">Continue â†’</button>
    </footer>

    <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
    <script src="scripts/config.js"></script>
    <script src="scripts/maintenance-wizard.js"></script>
</body>
</html>
